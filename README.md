# PyTorch CNN æµ‹è¯•é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨PyTorchæ„å»ºçš„ç®€æ˜“å·ç§¯ç¥ç»ç½‘ç»œé¡¹ç›®ï¼Œç”¨äºCIFAR-10å›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚æ”¯æŒå¤šæ¶æ„éƒ¨ç½²å’Œè·¨å¹³å°å¼€å‘ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ **PyTorchæ·±åº¦å­¦ä¹ æ¡†æ¶** - ä½¿ç”¨æœ€æ–°çš„PyTorch
- ğŸ“Š **CIFAR-10æ•°æ®é›†** - å›¾åƒåˆ†ç±»ä»»åŠ¡
- ğŸ³ **Dockerå®¹å™¨åŒ–** - ç¯å¢ƒéš”ç¦»ï¼Œéƒ¨ç½²ç®€å•
- ğŸ’» **è·¨å¹³å°å…¼å®¹** - Windows/Mac/Linuxéƒ½èƒ½è¿è¡Œ
- ğŸ—ï¸ **å¤šæ¶æ„æ”¯æŒ** - ARM64å’ŒAMD64æ¶æ„
- ğŸ“ˆ **å®Œæ•´æµç¨‹** - æ•°æ®åŠ è½½ã€è®­ç»ƒã€è¯„ä¼°ã€å¯è§†åŒ–
- ğŸ”„ **å®æ—¶åŒæ­¥** - ä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
- ğŸ“Š **å¯è§†åŒ–** - è®­ç»ƒè¿‡ç¨‹å’Œç»“æœå¯è§†åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

```
Project/
â”œâ”€â”€ ğŸ““ notebooks/              # Jupyter Notebookæ–‡ä»¶
â”‚   â”œâ”€â”€ cnn_test.ipynb        # ä¸»è¦çš„CNNæµ‹è¯•notebook
â”‚   â””â”€â”€ nms+osd.ipynb         # å…¶ä»–notebookæ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ› ï¸ scripts/               # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ deploy.sh             # Linux/Macéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ deploy.bat            # Windowséƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ build-multiarch.sh    # å¤šæ¶æ„æ„å»ºè„šæœ¬ (Mac/Linux)
â”‚   â”œâ”€â”€ build-multiarch.bat   # å¤šæ¶æ„æ„å»ºè„šæœ¬ (Windows)
â”‚   â””â”€â”€ test_sync.py          # åŒæ­¥æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“š docs/                  # æ–‡æ¡£æ–‡ä»¶
â”‚   â””â”€â”€ å¤šæ¶æ„éƒ¨ç½²æŒ‡å—.md      # å¤šæ¶æ„æ„å»ºæ–‡æ¡£
â”‚
â”œâ”€â”€ âš™ï¸ config/                # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ .devcontainer/        # å¼€å‘å®¹å™¨é…ç½®
â”‚       â””â”€â”€ devcontainer.json # VS Code/Cursorè¿œç¨‹å¼€å‘é…ç½®
â”‚
â”œâ”€â”€ ğŸ’¾ data/                  # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ (CIFAR-10æ•°æ®é›†ç­‰)
â”‚
â”œâ”€â”€ ğŸ¤– models/                # æ¨¡å‹æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ (è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶)
â”‚
â”œâ”€â”€ ğŸ³ Dockerç›¸å…³æ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile            # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ docker-compose.yml    # Docker Composeé…ç½®
â”‚   â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”‚   â””â”€â”€ .dockerignore         # Dockerå¿½ç•¥æ–‡ä»¶
â”‚
â””â”€â”€ ğŸ“„ é¡¹ç›®æ–‡æ¡£
    â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

#### Mac/Linuxç”¨æˆ·
```bash
./scripts/deploy.sh
```

#### Windowsç”¨æˆ·
```cmd
scripts\deploy.bat
```

### æ–¹æ³•2: ä½¿ç”¨Docker Compose

1. **æ„å»ºå¹¶å¯åŠ¨å®¹å™¨**
   ```bash
   docker-compose up --build
   ```

2. **è®¿é—®Jupyter Notebook**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8888
   - ä½¿ç”¨tokenç™»å½•ï¼ˆtokenä¼šåœ¨ç»ˆç«¯è¾“å‡ºä¸­æ˜¾ç¤ºï¼‰

3. **åœæ­¢å®¹å™¨**
   ```bash
   docker-compose down
   ```

### æ–¹æ³•3: ç›´æ¥ä½¿ç”¨Docker

1. **æ„å»ºé•œåƒ**
   ```bash
   docker build -t cnn-pytorch-jupyter .
   ```

2. **è¿è¡Œå®¹å™¨**
   ```bash
   docker run -p 8888:8888 -v $(pwd):/app cnn-pytorch-jupyter
   ```

### æ–¹æ³•4: æœ¬åœ°è¿è¡Œ

1. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

2. **å¯åŠ¨Jupyter**
   ```bash
   jupyter notebook
   ```

## ğŸ—ï¸ å¤šæ¶æ„æ”¯æŒ

### æ”¯æŒçš„æ¶æ„
- **ARM64** (Apple Silicon Mac, ARMæœåŠ¡å™¨)
- **AMD64** (Intel/AMD x64å¤„ç†å™¨)

### æ„å»ºå¤šæ¶æ„é•œåƒ

#### ä½¿ç”¨æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# Mac/Linux
./scripts/build-multiarch.sh

# Windows
scripts\build-multiarch.bat
```

#### æ‰‹åŠ¨æ„å»º
```bash
# åˆ›å»ºå¤šæ¶æ„æ„å»ºå™¨
docker buildx create --name multiarch --driver docker-container --use

# å¯åŠ¨æ„å»ºå™¨
docker buildx inspect --bootstrap

# æ„å»ºå¤šæ¶æ„é•œåƒ
docker buildx build \
  --platform linux/arm64,linux/amd64 \
  --tag cnn-pytorch-jupyter:latest \
  --load \
  .
```

### å„å¹³å°ä½¿ç”¨æ–¹æ³•

#### Apple Silicon Mac (ARM64)
```bash
# è‡ªåŠ¨ä½¿ç”¨ARM64æ¶æ„
docker-compose up -d
```

#### Intel Mac (AMD64)
```bash
# è‡ªåŠ¨ä½¿ç”¨AMD64æ¶æ„
docker-compose up -d
```

#### Windows (AMD64)
```cmd
# è‡ªåŠ¨ä½¿ç”¨AMD64æ¶æ„
docker-compose up -d
```

#### Linux (AMD64/ARM64)
```bash
# æ ¹æ®ç³»ç»Ÿæ¶æ„è‡ªåŠ¨é€‰æ‹©
docker-compose up -d
```

## ğŸ¯ æ¨¡å‹æ¶æ„

- **å·ç§¯å±‚**: 3å±‚å·ç§¯ï¼Œé€šé“æ•°åˆ†åˆ«ä¸º32ã€64ã€128
- **æ± åŒ–å±‚**: æœ€å¤§æ± åŒ–ï¼Œ2x2çª—å£
- **å…¨è¿æ¥å±‚**: 512ä¸ªéšè—å•å…ƒ + 10ä¸ªè¾“å‡ºå•å…ƒ
- **æ­£åˆ™åŒ–**: Dropout (0.5)
- **æ¿€æ´»å‡½æ•°**: ReLU

## âš™ï¸ è®­ç»ƒé…ç½®

- **ä¼˜åŒ–å™¨**: Adam (lr=0.001)
- **æŸå¤±å‡½æ•°**: CrossEntropyLoss
- **å­¦ä¹ ç‡è°ƒåº¦**: StepLR (æ¯10ä¸ªepoché™ä½0.1å€)
- **è®­ç»ƒè½®æ•°**: 20 epochs
- **æ‰¹æ¬¡å¤§å°**: 128

## ğŸ“Š æ•°æ®å¢å¼º

- éšæœºè£å‰ª (RandomCrop)
- éšæœºæ°´å¹³ç¿»è½¬ (RandomHorizontalFlip)
- æ•°æ®å½’ä¸€åŒ– (Normalize)

## ğŸ”„ ä»£ç åŒæ­¥æœºåˆ¶

### å®æ—¶åŒæ­¥
- **æœ¬åœ°ä¿®æ”¹** â†’ ç«‹å³åŒæ­¥åˆ°å®¹å™¨
- **å®¹å™¨å†…ä¿®æ”¹** â†’ ç«‹å³åŒæ­¥åˆ°æœ¬åœ°
- **æ”¯æŒè·¨å¹³å°å¼€å‘**

### å¼€å‘å·¥ä½œæµ
1. **åœ¨Cursorä¸­ç¼–è¾‘** - åˆ©ç”¨IDEçš„æ™ºèƒ½æç¤º
2. **åœ¨Jupyterä¸­è¿è¡Œ** - åˆ©ç”¨äº¤äº’å¼ç¯å¢ƒ
3. **å®æ—¶åŒæ­¥** - ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
4. **ç‰ˆæœ¬æ§åˆ¶** - ä½¿ç”¨Gitç®¡ç†ä»£ç 

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

1. è¿è¡Œnotebookä¸­çš„æ‰€æœ‰cell
2. æ¨¡å‹ä¼šè‡ªåŠ¨ä¸‹è½½CIFAR-10æ•°æ®é›†
3. è®­ç»ƒè¿‡ç¨‹ä¼šæ˜¾ç¤ºæŸå¤±å’Œå‡†ç¡®ç‡
4. è®­ç»ƒå®Œæˆåä¼šæ˜¾ç¤ºè¯¦ç»†è¯„ä¼°ç»“æœ
5. æ¨¡å‹ä¼šè‡ªåŠ¨ä¿å­˜ä¸º `cnn_model.pth`

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### åŸºæœ¬æ“ä½œ
```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs cnn-jupyter

# è·å–è®¿é—®token
docker-compose logs cnn-jupyter | grep token
```

### é«˜çº§æ“ä½œ
```bash
# é‡æ–°æ„å»ºé•œåƒ
docker-compose up --build -d

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# è¿›å…¥å®¹å™¨
docker-compose exec cnn-jupyter bash
```

## ğŸŒ è®¿é—®é¡¹ç›®

### è·å–è®¿é—®ä¿¡æ¯
```bash
# è·å–token
docker-compose logs cnn-jupyter | grep token

# è¾“å‡ºç¤ºä¾‹:
# http://127.0.0.1:8888/tree?token=YOUR_TOKEN_HERE
```

### æµè§ˆå™¨è®¿é—®
1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®: http://localhost:8888
3. è¾“å…¥token
4. æ‰“å¼€ `notebooks/cnn_test.ipynb` å¼€å§‹ä½¿ç”¨

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
å¦‚æœ8888ç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹ `docker-compose.yml`ï¼š
```yaml
ports:
  - "8889:8888"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

#### 2. å†…å­˜ä¸è¶³
è°ƒæ•´ `docker-compose.yml` ä¸­çš„å†…å­˜é™åˆ¶ï¼š
```yaml
deploy:
  resources:
    limits:
      memory: 8G  # å¢åŠ å†…å­˜é™åˆ¶
```

#### 3. æƒé™é—®é¢˜
åœ¨æŸäº›ç³»ç»Ÿä¸Šå¯èƒ½éœ€è¦ä½¿ç”¨sudoï¼š
```bash
sudo docker-compose up --build
```

#### 4. æ¶æ„ä¸åŒ¹é…
```bash
# å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šæ¶æ„
docker run --platform linux/amd64 cnn-pytorch-jupyter:latest
```

#### 5. æ„å»ºå¤±è´¥
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
docker buildx prune

# é‡æ–°åˆ›å»ºæ„å»ºå™¨
docker buildx rm multiarch
docker buildx create --name multiarch --driver docker-container --use
```

## ğŸ› ï¸ è„šæœ¬ä½¿ç”¨

### ğŸ“‹ è„šæœ¬åˆ—è¡¨

#### ğŸš€ å¯åŠ¨è„šæœ¬
- **start.sh** - å¿«é€Ÿå¯åŠ¨é¡¹ç›®

**åŠŸèƒ½**: æ£€æŸ¥Dockerç¯å¢ƒï¼Œå¯åŠ¨é¡¹ç›®

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/start.sh
```

#### ğŸ—ï¸ æ„å»ºè„šæœ¬
- **build-multiarch.sh** - Linux/Macå¤šæ¶æ„æ„å»ºè„šæœ¬
- **build-multiarch.bat** - Windowså¤šæ¶æ„æ„å»ºè„šæœ¬

**åŠŸèƒ½**: æ„å»ºæ”¯æŒARM64å’ŒAMD64æ¶æ„çš„Dockeré•œåƒ

**ä½¿ç”¨æ–¹æ³•**:
```bash
# Mac/Linux
./scripts/build-multiarch.sh

# Windows
scripts\build-multiarch.bat
```

#### ğŸ§¹ æ¸…ç†è„šæœ¬
- **cleanup-images.sh** - Dockeré•œåƒæ¸…ç†è„šæœ¬

**åŠŸèƒ½**: æ¸…ç†æœªä½¿ç”¨çš„Dockeré•œåƒå’Œæ„å»ºç¼“å­˜

**ä½¿ç”¨æ–¹æ³•**:
```bash
./scripts/cleanup-images.sh
```

### ğŸ¯ ä½¿ç”¨æµç¨‹

#### 1ï¸âƒ£ é¦–æ¬¡ä½¿ç”¨
```bash
# 1. å¯åŠ¨é¡¹ç›®
./scripts/start.sh

# 2. è®¿é—®Jupyter
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8888
```

#### 2ï¸âƒ£ å¼€å‘è¿‡ç¨‹ä¸­
```bash
# ä¿®æ”¹ä»£ç åé‡æ–°æ„å»º
./scripts/build-multiarch.sh

# é‡å¯æœåŠ¡
docker-compose restart
```

#### 3ï¸âƒ£ å®šæœŸç»´æŠ¤
```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
./scripts/cleanup-images.sh
```

## ğŸ“‹ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ
- **ARM Mac**: ä½¿ç”¨ARM64æ¶æ„
- **Intel Mac**: ä½¿ç”¨AMD64æ¶æ„
- **Windows**: ä½¿ç”¨AMD64æ¶æ„

### ç”Ÿäº§ç¯å¢ƒ
- **äº‘æœåŠ¡å™¨**: æ ¹æ®æœåŠ¡å™¨æ¶æ„é€‰æ‹©
- **å®¹å™¨ç¼–æ’**: ä½¿ç”¨å¤šæ¶æ„é•œåƒ
- **CI/CD**: æ„å»ºå¤šæ¶æ„é•œåƒ

### å›¢é˜Ÿåä½œ
1. **ä»£ç åŒæ­¥** - é€šè¿‡Gitå…±äº«ä»£ç 
2. **ç¯å¢ƒç»Ÿä¸€** - Dockeræä¾›ç»Ÿä¸€ç¯å¢ƒ
3. **è·¨å¹³å°** - ä¸åŒæ¶æ„çš„æœºå™¨éƒ½èƒ½ä½¿ç”¨
4. **æ–‡æ¡£å…±äº«** - ç»Ÿä¸€çš„é¡¹ç›®æ–‡æ¡£

## ğŸ¯ é¡¹ç›®ä¼˜åŠ¿

- âœ… **ç»“æ„æ¸…æ™°** - æ–‡ä»¶åˆ†ç±»æ˜ç¡®ï¼Œä¾¿äºç®¡ç†
- âœ… **è·¨å¹³å°** - Windows/Mac/Linuxéƒ½èƒ½è¿è¡Œ
- âœ… **å¤šæ¶æ„** - æ”¯æŒARM64å’ŒAMD64æ¶æ„
- âœ… **å®æ—¶åŒæ­¥** - ä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
- âœ… **æ•°æ®æŒä¹…åŒ–** - æ•°æ®å’Œæ¨¡å‹æ–‡ä»¶æŒä¹…ä¿å­˜
- âœ… **æ˜“äºéƒ¨ç½²** - ä¸€é”®éƒ¨ç½²è„šæœ¬
- âœ… **å®Œæ•´æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜
- âœ… **å¼€å‘å‹å¥½** - æ”¯æŒè¿œç¨‹å¼€å‘å’Œè°ƒè¯•
- âœ… **å›¢é˜Ÿåä½œ** - ç»Ÿä¸€å¼€å‘ç¯å¢ƒ
- âœ… **ç‰ˆæœ¬æ§åˆ¶** - Gité›†æˆ

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ARM64æ¶æ„ (Apple Silicon)
- âœ… **åŸç”Ÿæ€§èƒ½** - æœ€ä½³æ€§èƒ½
- âœ… **ä½åŠŸè€—** - ç”µæ± ç»­èˆªæ›´é•¿
- âœ… **å¿«é€Ÿå¯åŠ¨** - å®¹å™¨å¯åŠ¨æ›´å¿«

### AMD64æ¶æ„ (Intel/AMD)
- âœ… **å…¼å®¹æ€§** - å¹¿æ³›æ”¯æŒ
- âœ… **ç¨³å®šæ€§** - æˆç†Ÿç¨³å®š
- âš ï¸ **æ€§èƒ½** - åœ¨ARM Macä¸Šå¯èƒ½è¾ƒæ…¢

## ğŸ” éªŒè¯æ¶æ„æ”¯æŒ

### æ£€æŸ¥é•œåƒæ¶æ„
```bash
# æŸ¥çœ‹é•œåƒæ”¯æŒçš„æ¶æ„
docker buildx imagetools inspect cnn-pytorch-jupyter:latest

# æŸ¥çœ‹æœ¬åœ°é•œåƒæ¶æ„
docker image inspect cnn-pytorch-jupyter:latest | grep Architecture
```

### æ£€æŸ¥å®¹å™¨æ¶æ„
```bash
# è¿è¡Œå®¹å™¨å¹¶æ£€æŸ¥æ¶æ„
docker run --rm cnn-pytorch-jupyter:latest uname -m
```

## ğŸ“ æ³¨æ„äº‹é¡¹

- é¦–æ¬¡è¿è¡Œä¼šä¸‹è½½CIFAR-10æ•°æ®é›†ï¼ˆçº¦170MBï¼‰
- è®­ç»ƒè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ ååˆ†é’Ÿï¼Œå–å†³äºç¡¬ä»¶é…ç½®
- å»ºè®®ä½¿ç”¨GPUåŠ é€Ÿè®­ç»ƒï¼ˆå¦‚æœå¯ç”¨ï¼‰
- æ•°æ®ä¼šä¿å­˜åœ¨ `./data` ç›®å½•ä¸­
- æ¨¡å‹ä¼šä¿å­˜åœ¨ `./models` ç›®å½•ä¸­
- å®¹å™¨åˆ é™¤åï¼Œæ•°æ®ä»ç„¶ä¿å­˜åœ¨æœ¬åœ°

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Dockerå®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [PyTorchå®˜æ–¹æ–‡æ¡£](https://pytorch.org/docs/)
- [Jupyterå®˜æ–¹æ–‡æ¡£](https://jupyter.org/documentation)
- [CIFAR-10æ•°æ®é›†](https://www.cs.toronto.edu/~kriz/cifar.html)